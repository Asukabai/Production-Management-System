webpackJsonp([1],{Sq5Q:function(e,t){},Zzki:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("l/JR"),a=r("zL8q"),s={data:function(){return{timer:null,form:{file:""},fileListAdd:[],rules:{file:[{required:!0,message:"请选择文件上传",trigger:"change"}]},createProd:{prodModel:"",prodStage:"",prodDirector:""},totalDataNum:0,keywords:"",currentPage:1,pageSize:10,checkTaskDialogVisible:!1,newProdDialogVisible:!1,delProdDialogVisible:!1,sendMissionDialogVisible:!1,prodName:"",prodList:[],checkTaskList:[]}},mounted:function(){var e=this;this.timer=setInterval(function(){e.getProAndMisList()},1e3)},methods:{search:function(){this.currentPage=1,this.getProAndMisList()},clearInput:function(){this.keywords="",this.currentPage=1,this.getProAndMisList()},getProAndMisList:function(){var e=this,t={keywords:this.keywords,currentPage:this.currentPage,pageSize:this.pageSize};Object(o.n)(t).then(function(t){e.prodList=t.data.respData.prodListDetail,e.totalDataNum=t.data.respData.totalDataNum;for(var r=0;r<e.prodList.length;r++){1==e.prodList[r].ifsend?e.prodList[r].ifsend="已下发":e.prodList[r].ifsend="未下发",1==e.prodList[r].prodStatus?e.prodList[r].prodStatus="未实施":2==e.prodList[r].prodStatus?e.prodList[r].prodStatus="实施中":3==e.prodList[r].prodStatus?e.prodList[r].prodStatus="已完成":4==e.prodList[r].prodStatus?e.prodList[r].prodStatus="延期":5==e.prodList[r].prodStatus&&(e.prodList[r].prodStatus="停工");for(var o=0;o<e.prodList[r].children.length;o++)1==e.prodList[r].children[o].taskStatus?e.prodList[r].children[o].taskStatus="未实施":2==e.prodList[r].children[o].taskStatus?e.prodList[r].children[o].taskStatus="实施中":3==e.prodList[r].children[o].taskStatus?e.prodList[r].children[o].taskStatus="已完成":4==e.prodList[r].children[o].taskStatus?e.prodList[r].children[o].taskStatus="延期":5==e.prodList[r].children[o].taskStatus?e.prodList[r].children[o].taskStatus="检验中":6==e.prodList[r].children[o].taskStatus&&(e.prodList[r].children[o].taskStatus="终止")}})},handleSizeChange:function(e){console.log("SizeChange",e),this.pageSize=e,this.getProAndMisList()},handleCurrentChange:function(e){console.log("CurrentPage",e),this.currentPage=e,this.getProAndMisList()},countPageIndex:function(e){return(this.currentPage-1)*this.pageSize+e+1},delProd:function(e){console.log(e),this.delProdDialogVisible=!0,this.prodName=e.prodModel},delProdSure:function(){var e=this;Object(o.e)({prodModel:this.prodName}).then(function(t){console.log("删除产品res",t),1==t.data.result?(e.getProAndMisList(),a.Message.success(t.data.msg),e.delProdDialogVisible=!1):a.Message.error(t.data.msg)})},sendMissionBtn:function(e){console.log("row",e),this.sendMissionDialogVisible=!0,this.prodName=e.prodModel},sendProdMissionSure:function(){var e=this;Object(o.p)({prodModel:this.prodName}).then(function(t){console.log("下发产品任务RES",t),1==t.data.result?(e.getProAndMisList(),a.Message.success(t.data.msg),e.sendMissionDialogVisible=!1):a.Message.error(t.data.msg)})},checkTaskSheetBtn:function(e){var t=this;console.log("检验单row",e),Object(o.m)({prodModel:e.prodModel}).then(function(e){if(console.log("查看任务检验单res",e),1==e.data.result){t.checkTaskDialogVisible=!0,t.checkTaskList=e.data.respData;for(var r=0;r<t.checkTaskList.length;r++)3==t.checkTaskList[r].taskStatus&&(t.checkTaskList[r].taskStatus="已完成")}else a.Message.error(e.data.msg),t.checkTaskList=[]})},handleClose:function(e){e(),this.fileListAdd=[],this.createProd.prodModel="",this.createProd.prodStage="",this.createProd.prodDirector=""},addProd:function(){this.newProdDialogVisible=!0},handleExceed:function(e,t){this.$message.warning("只能选择 1个文件，本次选择了 "+e.length+" 个文件")},uploadOk:function(e){var t=this,r=JSON.parse(sessionStorage.getItem("userID"));this.uploaddata={prodModel:this.createProd.prodModel,prodStage:this.createProd.prodStage,prodDirector:this.createProd.prodDirector,creatorID:r};var s=new FormData;for(var i in this.uploaddata)s.append(i,this.uploaddata[i]);s.append("file",e.file),Object(o.s)(s).then(function(e){console.log("上传res",e),1==e.data.result?(t.getProAndMisList(),t.newProdDialogVisible=!1,a.Message.success(e.data.msg),t.fileListAdd=[],t.createProd.prodModel="",t.createProd.prodStage="",t.createProd.prodDirector=""):(t.fileListAdd=[],a.Message.error(e.data.msg))})},submit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.$refs.upload.submit()})},onChange:function(e){this.$set(this.form,"file",e)},removefile:function(){this.$set(this.form,"file","")},clearCheck:function(){this.$refs.form.clearValidate("file")}},beforeDestroy:function(){clearInterval(this.timer),this.timer=null}},i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"tableBox"},[r("div",{staticClass:"addProd"},[r("el-button",{attrs:{type:"primary"},on:{click:e.addProd}},[e._v("创建新产品")]),e._v(" "),r("div",{staticClass:"search"},[r("el-input",{attrs:{placeholder:"请输入产品号或任务名"},on:{input:e.search},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}},[r("i",{directives:[{name:"show",rawName:"v-show",value:e.keywords,expression:"keywords"}],staticClass:"el-icon-close",staticStyle:{"margin-top":"12px"},attrs:{slot:"suffix"},on:{click:e.clearInput},slot:"suffix"})])],1)],1),e._v(" "),r("el-dialog",{attrs:{visible:e.newProdDialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.newProdDialogVisible=t}}},[r("el-input",{attrs:{placeholder:"请输入产品型号"},model:{value:e.createProd.prodModel,callback:function(t){e.$set(e.createProd,"prodModel",t)},expression:"createProd.prodModel"}}),e._v(" "),r("el-input",{attrs:{placeholder:"请输入产品阶段"},model:{value:e.createProd.prodStage,callback:function(t){e.$set(e.createProd,"prodStage",t)},expression:"createProd.prodStage"}}),e._v(" "),r("el-input",{attrs:{placeholder:"请输入产品负责人"},model:{value:e.createProd.prodDirector,callback:function(t){e.$set(e.createProd,"prodDirector",t)},expression:"createProd.prodDirector"}}),e._v(" "),r("el-form",{ref:"form",staticStyle:{"padding-top":"20px"},attrs:{model:e.form,rules:e.rules}},[r("el-form-item",{attrs:{prop:"file"}},[r("el-upload",{ref:"upload",staticClass:"uploadProdExcel",attrs:{accept:".xlsx,.xls","auto-upload":!1,action:"action","http-request":e.uploadOk,"on-change":e.onChange,"on-exceed":e.handleExceed,"before-remove":e.removefile,limit:1,"file-list":e.fileListAdd},model:{value:e.form.file,callback:function(t){e.$set(e.form,"file",t)},expression:"form.file"}},[r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.clearCheck}},[e._v("上传Excel文件关联工序")]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传excel文件，且不超过10M")])],1)],1)],1),e._v(" "),r("el-button",{attrs:{type:"warning",align:"center"},on:{click:e.submit}},[e._v("保存")])],1),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#ccc",color:"#000"},data:e.prodList,"row-key":"id",border:"",stripe:"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[r("el-table-column",{attrs:{prop:"prodModel",align:"center",label:"产品型号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"prodCreateDay",align:"center",width:"150",label:"产品创建日期"}}),e._v(" "),r("el-table-column",{attrs:{prop:"prodStatus",align:"center",label:"产品状态"}}),e._v(" "),r("el-table-column",{attrs:{prop:"prodStage",align:"center",label:"产品阶段"}}),e._v(" "),r("el-table-column",{attrs:{prop:"taskCreatDay",align:"center",width:"150",label:"任务创建日期"}}),e._v(" "),r("el-table-column",{attrs:{prop:"taskName",align:"center",label:"任务名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"operator",align:"center",label:"操作员"}}),e._v(" "),r("el-table-column",{attrs:{prop:"taskStatus",align:"center",label:"任务状态"}}),e._v(" "),r("el-table-column",{attrs:{prop:"ifsend",align:"center",label:"下发状态"}}),e._v(" "),r("el-table-column",{attrs:{prop:"planDay",align:"center",label:"任务计划完成天数"}}),e._v(" "),r("el-table-column",{attrs:{prop:"realDay",align:"center",label:"任务实际完成天数"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"330",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children?r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.delProd(t.row)}}},[e._v("删除产品")]):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"提示",visible:e.delProdDialogVisible,width:"30%","append-to-body":"","before-close":e.handleClose},on:{"update:visible":function(t){e.delProdDialogVisible=t}}},[r("span",[e._v("确认删除该产品？")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.delProdDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.delProdSure}},[e._v("确 定")])],1)]),e._v(" "),t.row.children&&"未下发"==t.row.ifsend?r("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(r){return e.sendMissionBtn(t.row)}}},[e._v("下发产品任务")]):e._e(),e._v(" "),r("el-dialog",{attrs:{title:"提示",visible:e.sendMissionDialogVisible,width:"30%","append-to-body":"","before-close":e.handleClose},on:{"update:visible":function(t){e.sendMissionDialogVisible=t}}},[r("span",[e._v("确认下发产品任务？")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.sendMissionDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.sendProdMissionSure}},[e._v("下 发")])],1)]),e._v(" "),t.row.children&&"已下发"==t.row.ifsend?r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.checkTaskSheetBtn(t.row)}}},[e._v("查看检验单")]):e._e(),e._v(" "),r("el-dialog",{attrs:{"custom-class":"checkSheetDialog","append-to-body":"",title:"产品任务检验单",visible:e.checkTaskDialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.checkTaskDialogVisible=t}}},[r("el-table",{attrs:{stripe:"",border:"",fit:"","highlight-current-row":"",data:e.checkTaskList}},[r("el-table-column",{attrs:{align:"center",type:"index",width:"60",label:"序号"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"prodModel",label:"产品型号"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"prodStage",label:"产品阶段"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"taskName",label:"生产工序"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"taskStatus",label:"任务状态"}},[e._v("已完成")]),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"taskCreatday",label:"任务创建日期"}})],1)],1)]}}])})],1),e._v(" "),r("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,total:e.totalDataNum,layout:"total,prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},staticRenderFns:[]};var l=r("VU/8")(s,i,!1,function(e){r("Sq5Q")},"data-v-be293cb6",null);t.default=l.exports}});
//# sourceMappingURL=1.66c145c0949a47ad08ed.js.map